---
title: クラウドネイティブとは
date: "2020-12-28"
tags: ["cloud-native", "organize"]
description: クラウドネイティブという言葉が広いので調べて整理する
---

## 概要

クラウドネイティブっていう言葉を耳にするけど、よくよく考えてみるとクラウドネイティブってなんぞ？となったので調べてまとめてみた。  
結局クラウドネイティブ is XXX みたいな形に落ち着かなかったから全体感や構成要素の一部をまとめた雑記っぽくなってしまった。

## クラウドサービスモデルとは

クラウドネイティブの前にクラウドサービスとは、というところを整理する。  
主に以下のような特徴を持つものをクラウドサービスモデルという。

- コンピューティング資源を使い捨てできる環境のこと
- コードをデプロイすると自動でプロビジョニングまでする
- サイズ変更やスケーリングが可能
- リージョンや AZ の選択、移動が可能

サーバが[ペットから家畜](http://ec2-54-248-216-128.ap-northeast-1.compute.amazonaws.com/blog/2014/pets-vs-cattle/)になったという話は有名。

その他にもつながりがあるものとして [The Twelve-Factor Application](https://12factor.net/ja/) がある。Heroku（PaaS）をよく利用する開発者が様々な経験の末にアプリケーション開発時のベストプラクティスを文章としてまとめたもので、モダンな環境だと新たに 3 つ加えた 15 の観点があるそう。

1. API First
   - Front-End や gateway、その他のサービスから参照されることを前提にする
2. Telemetry
   - 設計段階で監視、ドメイン、ヘルス/システムデータが検討されていること
   - 監視は設計段階で考慮すべし
3. Authentication / Authorization
   - 最初から RBAC(role-based access control）な認証・認可を組み込んでおく

## クラウドネイティブとは

インターネットの海でゆらゆらしているとこんなことが書いてあった。なるほどな（？）

- アプリケーションをスケーラブルに構築・実行できるような環境のこと
- クラウドを利用する際のベストプラクティスを文言化したもの

### クラウドネイティブの構成要素

全てではないが代表的な構成要素は以下のような感じらしい。

- コンテナ
- マイクロサービス
- バッキングサービス
- サービスメッシュ
- イミュータブルインフラストラクチャ
- 宣言型 API

聞き慣れないものもあるのでそれぞれ調べてみる。

#### コンテナ

よく耳にするアレ。

特徴

- ホスト OS 上で動きホスト OS のリソースを各コンテナで共有するが、それぞれのコンテナは環境として分離されている
- それぞれのコンテナが分離されているため移植性・一貫性を保ちつつ依存関係を排除できる
- コンテナオーケストレーションによってヘルスチェックやフェールオーバー、スケーリングなどを自動で実施できる
  - CNCF がホストするプロダクトは kubernetes 上で動かす前提のものがほとんどなので実質 kubernetes 一強

コンテナのメリット

- 一度コンテナ上で動くものを作ればどの環境でも動作する（コンテナのエンジンが同じ場合）
- VM と異なり OS は仮想化しないためホストマシン一台あたりの密度を上げることができる

#### マイクロサービス

特徴

- 大きなドメインの中で独立したビジネス機能を持つ
- 自律的に開発でき、その他のサービスに依らず独立してデプロイできる
- カプセル化（それ単体で動作するという意味）した独自のデータストレージとプログラミング環境を持つ
- 独自のプロセスで動き、標準的なプロトコルを介して通信ができる
- 互いに作用しあいアプリケーションを構成する

マイクロサービスアーキテクチャのメリット

- それぞれが独立して開発・デプロイ・スケーリングできるため素早い開発サイクルを実現できる
- 細やかな変更をしやすい

大雑把にはわかるけどじゃあ実際にマイクロサービスアーキテクチャでやっていきましょうとなったときに分割単位どうすんのとか詳しいことはよくわからん。

#### バッキングサービス

補助的なサービスのこと。注目しているプロダクトに対して補助的という意味合いなのかな。

- モニタリング
- ストレージサービス
- MQ のブローカー
- セキュリティサービス
- データベース
- などなど

#### サービスメッシュ

特徴

- 可観測性・アプリの識別・ロードランシング・認証・通信の暗号化を含むプロキシ
- マイクロサービス的な思想で設計・実装した者同士が一対一で通信する場合に、間にプロキシを置かないとえげつない変更があった場合に変更箇所が結果的に多くなってしまうこともある

サービスメッシュのメリット

- アプリケーション側に実装せずにサイドカーとして用意することで様々なアプリケーションに対応できる

実装しなくてもいいけど意識はしておかないと後々困りそう。想像だが。

#### イミュータブルインフラストラクチャ

特徴

- イミュータブルは不変のことで本番環境を変更せずにリリースするためイミュータブルと呼ぶ
- 本番と開発で全く同じインフラ構成の 2 環境を用意し、開発環境でセキュリティパッチ等をあてて全体の動作確認で問題がない場合はルータなどで本番環境から開発環境へトラフィックを移す
- 本番から開発へアクセス先を切り替えると、それまでは本番環境だったものは開発環境として扱う

イミュータブルインフラストラクチャのメリット

- 本番環境を変更しないため無停止実施などに気を使わなくて良い
- ユーザがアクセスする環境はルーティングによって切り替えられているだけなので、問題が発覚した場合は再度ルーティングを切り替えるだけで済む

確かに理にかなってるけど費用めっちゃ掛かりそう。稟議の鬼が必要。👹

#### 宣言型 API

特徴

- API を叩く側が挙動を細かく伝えることができるのが命令的 API、API 叩く側が結果のみ伝えることができるのが宣言的 API

  - 宣言的は Declarative、対義語は命令的 Imperative

- API 名は状態を記述する

宣言的 API のメリット

- API の内部の振る舞いを変更しても API を叩く側が変更を意識する必要がない

「いい感じに xxx してくれる」ボタンのイメージですかね。あまり意識せずに宣言的 API の思想を取り入れてる人は多そうなイメージ。

## おわり

登場するキーワードが多すぎたり定義が曖昧だったりするのでざっとさらうだけでも結構苦労した。 ~~これ全部理解してる人ほんとにいるの？~~

時間をかけた割に得られるものが少なかった、掘り下げるポイントが良くなかった？  
なにはともあれクラウドネイティブ、奥が深い。。

おしまい(¦3[___]

## 参考

- <https://github.com/cncf/toc/blob/master/DEFINITION.md#%E6%97%A5%E6%9C%AC%E8%AA%9E%E7%89%88>
- <https://docs.microsoft.com/ja-jp/dotnet/architecture/cloud-native/definition>
- <https://12factor.net/>
- <https://www.ibm.com/blogs/think/jp-ja/cloud-native-concept-01/>
- <https://qiita.com/Hiroyuki_OSAKI/items/f3f88ae535550e95389d>
- <https://japan.zdnet.com/article/35094557/2/>
- <https://blog.newrelic.co.jp/story/metrics-events-logs-and-traces/>
- <https://y-ohgi.blog/entry/2019/08/19/%E7%9B%A3%E8%A6%96%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E6%80%9D%E3%81%86%E3%81%A8%E3%81%93>
